
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙØªÙŠØ´ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</title>
  <style>
    :root{
      --bg1:#0b1220; --bg2:#0f1a33;
      --card:#ffffff; --ink:#0b1220;
      --line:#e6e8ee;
      --accent:#2563eb; --accent2:#1d4ed8;
      --ok:#16a34a; --warn:#b45309;

      --noteText:#7c2d12;
      --noteBg:#fffbeb;
      --noteBorder:#f59e0b;

      --shadow: rgbal: rgba(2,6,23,.18);
      --shadow: rgba(2,6,23,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Tahoma,Arial;
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(37,99,235,.25), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(22,163,74,.18), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      min-height:100vh;
      padding:18px;
    }
    .wrap{max-width:1024px;margin:0 auto}
    .hero{color:#fff;margin:6px 0 14px}
    .hero h1{margin:0;font-size:24px;letter-spacing:.2px}

    .card{
      background:var(--card);
      border-radius:18px;
      box-shadow:0 18px 45px var(--shadow);
      overflow:hidden;
    }
    .topbar{
      padding:14px 16px;
      background:linear-gradient(90deg, rgba(37,99,235,.10), rgba(22,163,74,.08));
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .gate{
      font-size:13px;
      font-weight:950;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid;
      display:inline-flex;
      align-items:center;
      gap:8px;
      background:#fff;
    }
    .gate.bad{color:var(--warn);background:#fff7ed;border-color:#fed7aa}
    .gate.good{color:var(--ok);background:#dcfce7;border-color:#bbf7d0}

    .content{padding:16px}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media(max-width:900px){.grid{grid-template-columns:1fr 1fr}}
    @media(max-width:520px){.grid{grid-template-columns:1fr}}
    label{font-size:13px;font-weight:900;color:#111827}
    input,select,textarea{
      width:100%;
      padding:12px;
      margin-top:6px;
      border:1px solid var(--line);
      border-radius:12px;
      font-size:15px;
      background:#fff;
      outline:none;
    }
    input:focus,select:focus,textarea:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 0 0 4px rgba(37,99,235,.12);
    }
    .hint{margin-top:6px;font-size:12px;color:#64748b;line-height:1.5}

    .actions{
      padding:0 16px 16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    button{
      border:0;
      border-radius:12px;
      padding:12px 16px;
      font-weight:950;
      font-size:15px;
      cursor:pointer;
      touch-action:manipulation;
    }
    .btn-primary{background:var(--accent);color:#fff}
    .btn-primary:hover{background:var(--accent2)}
    .btn-primary:disabled{opacity:.5;cursor:not-allowed}
    .btn-ghost{background:#eef2ff;color:#111827}

    .tablewrap{
      margin:0 16px 16px;
      border:1px solid var(--line);
      border-radius:16px;
      overflow:auto;
    }
    table{width:100%;border-collapse:collapse;min-width:940px}
    th,td{border-bottom:1px solid var(--line);padding:12px 10px;font-size:14px;vertical-align:top}
    th{background:#f8fafc;font-weight:950;text-align:center}

    .check{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      font-weight:950;
      background:#fff;
    }

    textarea.has-note{
      background:var(--noteBg);
      border-color:var(--noteBorder);
      color:var(--noteText);
      font-weight:750;
    }
    .note-flag{
      margin-top:6px;
      font-size:12px;
      font-weight:950;
      color:var(--noteBorder);
      display:none;
    }
    textarea.auto-note{color:#555;font-style:italic;}

    /* PDF */
    .print-header{display:none}
    .no-print{ /* used for print */ }
    @media print{
      body{background:#fff !important;padding:0 !important;}
      .no-print{display:none !important;}
      .card{box-shadow:none !important;border-radius:0 !important;}
      .tablewrap{margin:0;border:1px solid #ddd;border-radius:0}
      table{min-width:0}
      th,td{font-size:12px}
      input,select,textarea{border:0 !important; padding:0 !important; box-shadow:none !important; background:transparent !important;}
      textarea.has-note{
        background:#fff3cd !important;
        border:1px solid #f59e0b !important;
        padding:6px !important;
      }
      .print-header{
        display:block !important;
        padding:12px;
        border-bottom:1px solid #ddd;
      }
      .print-title{margin:0 0 6px;font-size:16px;font-weight:950}
      .print-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px 12px;font-size:12px}
      .kv{display:flex;gap:6px;align-items:baseline}
      .k{color:#555;font-weight:900}
      .v{color:#111}
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="hero no-print">
    <h1>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙØªÙŠØ´ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</h1>
  </div>

  <div class="card">
    <div class="topbar no-print">
      <div class="gate bad" id="gate">â›” ÙŠÙ„Ø²Ù… ØªØ£ÙƒÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ù‚Ø¨Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±</div>
      <div class="gate" id="empStatus">â€”</div>
    </div>

    <!-- PDF header only -->
    <div class="print-header">
      <div class="print-title">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙØªÙŠØ´ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</div>
      <div class="print-grid" id="printGrid"></div>
    </div>

    <div class="content no-print">
      <div class="grid">
        <div>
          <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
          <input id="empNo" inputmode="numeric" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" />
          <button type="button" class="btn-ghost" id="fetchNameBtn" style="margin-top:8px;width:100%;">ğŸ” Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…</button>
          <div class="hint">ØªÙ„Ù…ÙŠØ­: Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù‚Ù… Ø«Ù… Ø§Ø¶ØºØ· (Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…).</div>
        </div>

        <div>
          <label>Ø§Ù„Ø§Ø³Ù…</label>
          <input id="guardName" placeholder="Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¹Ù†Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…" />
          <div class="hint">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù….</div>
        </div>

        <div>
          <label>Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</label>
          <select id="shift">
            <option value="">Ø§Ø®ØªØ±</option><option>Ø£</option><option>Ø¨</option><option>Ø¬</option><option>Ø¯</option>
          </select>
        </div>

        <div>
          <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
          <input id="date" type="date" />
        </div>
      </div>
    </div>

    <div class="actions no-print">
      <button class="btn-primary" id="pdfBtn" disabled>ØªØµØ¯ÙŠØ± PDF</button>
      <button class="btn-ghost" id="clearBtn" type="button">Ù…Ø³Ø­</button>
    </div>

    <div class="tablewrap">
      <table>
        <thead>
          <tr>
            <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
            <th>Ø§Ù„Ø£Ù†Ø¸Ù…Ø©</th>
            <th>ØªÙ…</th>
            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  // ==== Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Ù…Ø¯Ù…Ø¬Ø©) ====
  const empDB = {
    "88835": { name: "ÙÙ‡Ø¯ Ø§Ù„Ø´Ù…Ø±ÙŠ", shift: "Ø¨" },
    "88840": { name: "Ù…Ø­Ù…Ø¯ Ø­Ù…Ø¯", shift: "Ø£" }
  };

  // ==== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ====
  const sites = [
    { site:"Ù…Ø¨Ù†Ù‰ A Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø®Ø§Ù…Ø³ ÙˆØ§Ù„Ø£Ø±Ø¶ÙŠ ÙˆØ§Ù„Ù…ÙˆØ§Ù‚Ù â€“ LG â€“ B", systems:"Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ + Ø§ÙƒØ³Ø³ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨" },
    { site:"Ù…Ø¨Ù†Ù‰ B Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø®Ø§Ù…Ø³ ÙˆØ§Ù„Ø£Ø±Ø¶ÙŠ ÙˆØ§Ù„Ù…ÙˆØ§Ù‚Ù â€“ LG â€“ B", systems:"Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ + Ø§ÙƒØ³Ø³ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨" },
    { site:"Ù…Ø¨Ù†Ù‰ C Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø£Ø±Ø¶ÙŠ ÙˆØ§Ù„Ù…ÙˆØ§Ù‚Ù â€“ LG â€“ B", systems:"Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ + Ø§ÙƒØ³Ø³ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨" },
    { site:"Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¬ B", systems:"Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ†" },
    { site:"Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù…Ø§Ù… Ù…Ø¨Ù†Ù‰ D", systems:"Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ + Ø§ÙƒØ³Ø³ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨" },
    { site:"Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© + Ø§Ù„Ù…ØµØ¯Ø§Øª Ø§Ù„Ø¨Ù„Ø§Ø³ØªÙŠÙƒÙŠØ© Ù„Ù„Ù…ÙˆØ§Ù‚Ù Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©.", systems:"Ø¥ØºÙ„Ø§Ù‚ Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ù…ØµØ¯Ø§Øª Ø§Ù„Ø¨Ù„Ø§Ø³ØªÙŠÙƒÙŠØ©" }
  ];

  const rowsEl = document.getElementById("rows");
  const pdfBtn = document.getElementById("pdfBtn");
  const gate = document.getElementById("gate");
  const empStatus = document.getElementById("empStatus");

  const empNoEl = document.getElementById("empNo");
  const nameEl  = document.getElementById("guardName");

  function normalizeEmpNo(s){
    const map = {"Ù ":"0","Ù¡":"1","Ù¢":"2","Ù£":"3","Ù¤":"4","Ù¥":"5","Ù¦":"6","Ù§":"7","Ù¨":"8","Ù©":"9"};
    let t = String(s||"").trim().replace(/[Ù -Ù©]/g, d => map[d] || d);
    t = t.replace(/[^0-9]/g, "");
    return t;
  }

  function updateEmpStatus(){
    const no = normalizeEmpNo(empNoEl.value);
    if(!no){
      empStatus.textContent = "â€”";
      empStatus.className = "gate";
      return;
    }
    if(empDB[no]){
      empStatus.textContent = "âœ… ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸Ù";
      empStatus.className = "gate good";
    }else{
      empStatus.textContent = "â„¹ï¸ Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
      empStatus.className = "gate bad";
    }
  }

  function fetchName(){
    const no = normalizeEmpNo(empNoEl.value);
    empNoEl.value = no;
    if(empDB[no]){
      nameEl.value = empDB[no].name;
      document.getElementById("shift").value = empDB[no].shift;
      updateEmpStatus();
      return true;
    }
    updateEmpStatus();
    alert("Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©");
    return false;
  }

  function renderSites(){
    rowsEl.innerHTML="";
    sites.forEach((r,i)=>{
      const tr=document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHtml(r.site)}</td>
        <td>${escapeHtml(r.systems)}</td>
        <td style="text-align:center">
          <label class="check"><input type="checkbox" id="chk_${i}"> ØªÙ…</label>
        </td>
        <td>
          <textarea id="note_${i}" placeholder="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
          <div class="note-flag" id="flag_${i}">âš  ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø©</div>
        </td>
      `;
      rowsEl.appendChild(tr);

      document.getElementById("chk_"+i).addEventListener("change", refreshGate);
      document.getElementById("note_"+i).addEventListener("input", ()=>noteCheck(i));
    });
  }

  function noteCheck(i){
    const n=document.getElementById("note_"+i);
    const f=document.getElementById("flag_"+i);
    if(n.value.trim()){
      n.classList.add("has-note");
      n.classList.remove("auto-note");
      f.style.display="block";
    }else{
      n.classList.remove("has-note","auto-note");
      f.style.display="none";
    }
  }

  function allChecked(){
    return sites.every((_,i)=>document.getElementById("chk_"+i).checked);
  }

  function refreshGate(){
    const ok = allChecked();
    pdfBtn.disabled = !ok;
    if(ok){
      gate.textContent="âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ â€” Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØµØ¯ÙŠØ±";
      gate.className="gate good";
    }else{
      gate.textContent="â›” ÙŠÙ„Ø²Ù… ØªØ£ÙƒÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ù‚Ø¨Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±";
      gate.className="gate bad";
    }
  }

  function buildPrintHeader(){
    const guardName = nameEl.value || "â€”";
    const empNo = empNoEl.value || "â€”";
    const shift = document.getElementById("shift").value || "â€”";
    const date  = document.getElementById("date").value || "â€”";

    document.getElementById("printGrid").innerHTML = `
      <div class="kv"><span class="k">Ø§Ù„Ø§Ø³Ù…:</span><span class="v">${escapeHtml(guardName)}</span></div>
      <div class="kv"><span class="k">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ:</span><span class="v">${escapeHtml(empNo)}</span></div>
      <div class="kv"><span class="k">Ø§Ù„ÙˆØ±Ø¯ÙŠØ©:</span><span class="v">${escapeHtml(shift)}</span></div>
      <div class="kv"><span class="k">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span><span class="v">${escapeHtml(date)}</span></div>
    `;
  }

  function exportPDF(){
    if(!allChecked()) return;

    // Ø§Ù…Ù„Ø£ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙØ§Ø±ØºØ© Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
    sites.forEach((_,i)=>{
      const n=document.getElementById("note_"+i);
      if(!n.value.trim()){
        n.value="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª";
        n.classList.add("auto-note");
      }
    });

    buildPrintHeader();
    window.print();
  }

  function clearAll(){
    empNoEl.value="";
    nameEl.value="";
    document.getElementById("shift").value="";
    document.getElementById("date").value="";
    sites.forEach((_,i)=>{
      const chk=document.getElementById("chk_"+i);
      const note=document.getElementById("note_"+i);
      const flag=document.getElementById("flag_"+i);
      if(chk) chk.checked=false;
      if(note){ note.value=""; note.classList.remove("has-note","auto-note"); }
      if(flag) flag.style.display="none";
    });
    refreshGate();
    updateEmpStatus();
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // events
  document.getElementById("fetchNameBtn").addEventListener("click", fetchName);
  empNoEl.addEventListener("input", updateEmpStatus);
  empNoEl.addEventListener("change", updateEmpStatus);

  document.getElementById("pdfBtn").addEventListener("click", exportPDF);
  document.getElementById("clearBtn").addEventListener("click", clearAll);

  // init
  renderSites();
  refreshGate();
  updateEmpStatus();
</script>
</body>
</html>
